<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta http-equiv="refresh" content="0; url=delivery.php" />
  <title>Redirecting…</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; display:flex; align-items:center; justify-content:center; height:100vh; margin:0; background:#f8fafc; color:#334155; }
    a { color:#4f46e5; text-decoration:none; font-weight:600; }
  </style>
</head>
<body>
  <div>
    <p>Redirecting to the Deliveries dashboard… If you are not redirected, <a href="delivery.php">click here</a>.</p>
  </div>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta http-equiv="refresh" content="0; url=delivery.php" />
  <title>Redirecting…</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; display:flex; align-items:center; justify-content:center; height:100vh; margin:0; background:#f8fafc; color:#334155; }
    a { color:#4f46e5; text-decoration:none; font-weight:600; }
  </style>
</head>
<body>
  <div>
    <p>Redirecting to the Deliveries dashboard… If you are not redirected, <a href="delivery.php">click here</a>.</p>
  </div>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta http-equiv="refresh" content="0; url=delivery.php" />
  <title>Redirecting…</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; display:flex; align-items:center; justify-content:center; height:100vh; margin:0; background:#f8fafc; color:#334155; }
    a { color:#4f46e5; text-decoration:none; font-weight:600; }
  </style>
</head>
<body>
  <div>
    <p>Redirecting to the Deliveries dashboard… If you are not redirected, <a href="delivery.php">click here</a>.</p>
  </div>
}

function statusBadge(status){
  let cls="badge";
  if(status==="Pending") cls+=" pending";
  if(status==="Shipped") cls+=" shipped";
  if(status==="Delivered") cls+=" delivered";
  if(status==="Failed") cls+=" failed";
  return `<span class="${cls}">${status}</span>`;
}

function actionButtons(order){
  if(order.status==="Pending"){
    return `<button class="btn" data-action="ship" data-id="${order.id}">Ship</button>`;
  }
  if(order.status==="Shipped"){
    return `<button class="btn secondary" data-action="deliver" data-id="${order.id}">Mark Delivered</button>`;
  }
  return `<button class="btn secondary" data-action="view" data-id="${order.id}">View</button>`;
}

function renderTable(){
  const tbody=document.querySelector("#deliveryTable tbody");
  tbody.innerHTML="";
  deliveries.slice().reverse().forEach(d=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${d.id}</td><td>${d.customer}</td><td>${statusBadge(d.status)}</td><td>${d.date}</td><td style="text-align:right">${actionButtons(d)}</td>`;
    tbody.appendChild(tr);
  });
  attachHandlers();
}

function attachHandlers(){
  document.querySelectorAll("#deliveryTable button").forEach(btn=>{
    btn.addEventListener("click",()=>{
      const action=btn.dataset.action;
      const id=btn.dataset.id;
      const idx=deliveries.findIndex(d=>d.id===id);
      if(idx<0) return;
      if(action==="ship"){ deliveries[idx].status="Shipped"; }
      if(action==="deliver"){ deliveries[idx].status="Delivered"; }
      if(action==="view"){ alert(JSON.stringify(deliveries[idx],null,2)); return; }
      deliveries[idx].date=new Date().toISOString().slice(0,10);
      renderAll();
    });
  });
}

function createCharts(){
  statusChart=new Chart(document.getElementById("statusChart").getContext("2d"),{
    type:"doughnut",
    data:{labels:["Pending","Shipped","Delivered","Failed"],datasets:[{data:[],backgroundColor:["#facc15","#38bdf8","#22c55e","#ef4444"]}]},
    options:{plugins:{legend:{position:"bottom"}}}
  });

  monthlyChart=new Chart(document.getElementById("monthlyChart").getContext("2d"),{
    type:"bar",
    data:{labels:[],datasets:[{label:"Deliveries",data:[],backgroundColor:varAccent()}]},
    options:{scales:{y:{beginAtZero:true}}}
  });
}

function varAccent(){ return getComputedStyle(document.documentElement).getPropertyValue("--accent"); }

function updateCharts(){
  const counts={Pending:0,Shipped:0,Delivered:0,Failed:0};
  deliveries.forEach(d=>counts[d.status]++);
  statusChart.data.datasets[0].data=[counts.Pending,counts.Shipped,counts.Delivered,counts.Failed];
  statusChart.update();

  const months=[];const vals=[];
  const now=new Date();
  for(let i=5;i>=0;i--){
    const d=new Date(now.getFullYear(),now.getMonth()-i,1);
    const key=d.toLocaleString(undefined,{month:"short",year:"numeric"});
    months.push(key); vals.push(0);
  }
  deliveries.forEach(d=>{
    if(d.status!=="Delivered") return;
    const dt=new Date(d.date);
    const key=dt.toLocaleString(undefined,{month:"short",year:"numeric"});
    const idx=months.indexOf(key);
    if(idx>=0) vals[idx]++;
  });
  monthlyChart.data.labels=months;
  monthlyChart.data.datasets[0].data=vals;
  monthlyChart.update();
}

function renderAll(){
  renderMetrics();
  renderTable();
  updateCharts();
}

function init(){
  createCharts();
  renderAll();
}
init();
</script>
</body>
</html>
